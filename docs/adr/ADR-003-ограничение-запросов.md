# ADR-003: Реализация Rate Limiting

## Статус
Принято (Accepted)

## Контекст
Система бронирования парковочных мест подвержена DDoS атакам и brute-force атакам на эндпоинты аутентификации. Необходимо защитить доступность сервиса.

## Решение
Внедрить многоуровневое ограничение запросов на уровне приложения (без внешнего Redis):
1. **Глобальный лимит**: 1000 запросов в час на IP
2. **Лимит аутентификации**: 10 попыток входа/регистрации в минуту на IP
3. **Лимит бронирований**: 10 созданий бронирования в минуту на IP
4. **Лимит проверки доступности**: 30 запросов в минуту на IP

Счетчики хранятся в памяти процесса (`collections.defaultdict`), очищаются при каждом запросе, а значение `Retry-After` возвращается через RFC 7807 problem-details. Для разработки лимиты можно отключить переменной `DISABLE_RATE_LIMIT`.

## Последствия
### Положительные
- Защита от DDoS и brute-force атак
- Справедливое распределение ресурсов
- Соответствие NFR требованиям

### Отрицательные
- Решение stateful и не масштабируется горизонтально без sticky-сессий
- Нет долговременной истории запросов; перезапуск сервиса обнуляет счетчики

## Связи
- **NFR**: SEC-002, PERF-001
- **Угрозы**: F7 (Denial of Service), R-02 (DDoS атаки)
- **Тесты**: Ограничение отключается в `tests/conftest.py`; мануальные проверки выполняются через нагрузочные запросы
- **Код**: `app/middleware/rate_limit.py`
